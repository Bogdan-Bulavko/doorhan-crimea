// Prisma schema for DoorHan Crimea admin

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum UserRole {
  customer
  admin
  manager
}

enum OrderStatus {
  pending
  confirmed
  processing
  shipped
  delivered
  cancelled
}

enum PaymentStatus {
  pending
  paid
  failed
  refunded
}

model User {
  id           Int        @id @default(autoincrement())
  email        String     @unique
  passwordHash String
  firstName    String
  lastName     String
  phone        String?
  role         UserRole   @default(customer)
  isActive     Boolean    @default(true)
  avatarUrl    String?
  preferences  Json?
  orders       Order[]
  adminLogs    AdminLog[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Category {
  id             Int        @id @default(autoincrement())
  name           String
  description    String?
  imageUrl       String?
  iconName       String?
  color          String?
  hoverColor     String?
  slug           String     @unique
  parentId       Int?
  parent         Category?  @relation("CategoryChildren", fields: [parentId], references: [id])
  children       Category[] @relation("CategoryChildren")
  isActive       Boolean    @default(true)
  sortOrder      Int        @default(0)
  seoTitle       String?
  seoDescription String?
  canonicalUrl   String?
  h1             String?
  robotsMeta     String?    @default("index, follow")
  schemaMarkup   String?
  products       Product[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

model Product {
  id               Int                    @id @default(autoincrement())
  name             String
  title            String?
  description      String?
  shortDescription String?
  mainImageUrl     String?
  categoryId       Int
  category         Category               @relation(fields: [categoryId], references: [id])
  slug             String                 @unique
  sku              String?                @unique
  price            Decimal
  oldPrice         Decimal?
  currency         String                 @default("RUB")
  inStock          Boolean                @default(true)
  stockQuantity    Int                    @default(0)
  isNew            Boolean                @default(false)
  isPopular        Boolean                @default(false)
  isFeatured       Boolean                @default(false)
  rating           Decimal                @default(0)
  reviewsCount     Int                    @default(0)
  seoTitle         String?
  seoDescription   String?
  canonicalUrl     String?
  h1               String?
  robotsMeta       String?                @default("index, follow")
  schemaMarkup     String?
  specifications   ProductSpecification[]
  colors           ProductColor[]
  images           ProductImage[]
  orderItems       OrderItem[]
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  imageUrl  String
  altText   String?
  sortOrder Int      @default(0)
  isMain    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model ProductSpecification {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  name      String
  value     String
  unit      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
}

model ProductColor {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  name      String
  value     String
  hexColor  String
  imageUrl  String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
}

model Order {
  id              Int           @id @default(autoincrement())
  orderNumber     String        @unique
  userId          Int?
  user            User?         @relation(fields: [userId], references: [id])
  customerInfo    Json
  status          OrderStatus   @default(pending)
  paymentStatus   PaymentStatus @default(pending)
  shippingAddress Json
  billingAddress  Json?
  subtotal        Decimal
  shippingCost    Decimal       @default(0)
  tax             Decimal       @default(0)
  discount        Decimal       @default(0)
  total           Decimal
  currency        String        @default("RUB")
  notes           String?
  items           OrderItem[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model OrderItem {
  id              Int      @id @default(autoincrement())
  orderId         Int
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId       Int?
  product         Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  quantity        Int
  price           Decimal
  totalPrice      Decimal
  selectedColor   String?
  selectedOptions Json?
  createdAt       DateTime @default(now())
}

model ContactForm {
  id         Int      @id @default(autoincrement())
  name       String
  email      String
  phone      String?
  company    String?
  subject    String
  message    String
  status     String   @default("new")
  adminNotes String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model CallbackRequest {
  id            Int      @id @default(autoincrement())
  name          String
  phone         String
  preferredTime String?
  message       String?
  status        String   @default("new")
  adminNotes    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model SiteSetting {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  value       String?
  type        String   @default("string")
  description String?
  updatedAt   DateTime @updatedAt
}

model AdminLog {
  id        Int      @id @default(autoincrement())
  userId    Int?
  user      User?    @relation(fields: [userId], references: [id])
  action    String
  tableName String?
  recordId  Int?
  oldValues Json?
  newValues Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
}

model Region {
  id                      Int      @id @default(autoincrement())
  code                    String   @unique
  name                    String
  phone                   String
  phoneFormatted          String
  email                   String
  address                 String
  addressDescription      String?
  workingHours            String
  workingHoursDescription String?
  mapIframe               String?
  officeName              String?
  isActive                Boolean  @default(true)
  sortOrder               Int      @default(0)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model Page {
  id             Int      @id @default(autoincrement())
  title          String
  slug           String   @unique
  content        String
  seoTitle       String?
  seoDescription String?
  canonicalUrl   String?
  h1             String?
  robotsMeta     String?  @default("index, follow")
  schemaMarkup   String?
  isActive       Boolean  @default(true)
  sortOrder      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
